# Gover - Session 自动失效测试

## 🧪 测试步骤

### 测试 1: 密码修改后自动失效

1. **登录系统**
   - 访问 http://localhost:8088
   - 使用当前密码登录

2. **修改密码**
   - 编辑 `config.yaml` 文件
   - 修改 `auth.password` 字段
   - 保存文件

3. **重启服务**
   ```bash
   # 停止当前服务（Ctrl+C）
   ./gover
   ```

4. **测试 Session 失效**
   - 刷新浏览器页面
   - 应该自动跳转到登录页面
   - 使用新密码登录

### 测试 2: 命令行清除所有 Session

1. **登录系统**
   - 确保至少有一个用户已登录

2. **清除 Session**
   - 在服务器上执行命令：
   ```bash
   ./gover -clear-sessions
   ```

3. **验证失效**
   - 刷新浏览器页面
   - 应该自动跳转到登录页面
   - 所有用户的 Session 都已失效

## ✅ 预期结果

- **密码修改**: 所有现有 Session 自动失效，需要使用新密码重新登录
- **命令行清除**: 所有 Session 立即失效，用户需要重新登录
- **安全性**: 旧的登录状态不会继续有效

## 🔧 技术原理

### 配置哈希验证
每个 Session 包含配置哈希值：
```
config_hash = SHA256(username + password + session_secret)
```

### 验证流程
1. 用户访问页面
2. 系统读取 Session 中的 `config_hash`
3. 计算当前配置的哈希值
4. 比较两个哈希值
5. 如果不匹配，Session 失效

### 清除机制
- **自动失效**: 配置变更时自动检测
- **命令行清除**: 通过 `-clear-sessions` 参数清除
- **即时生效**: 下次请求立即生效

## 🛡️ 安全优势

- **防止权限升级**: 密码修改后旧 Session 无法继续使用
- **及时响应**: 安全事件发生时可快速清除所有 Session
- **透明机制**: 用户无感知的自动安全检查
- **管理便利**: 管理员可通过命令行控制 Session 状态 